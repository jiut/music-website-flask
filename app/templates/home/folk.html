{% extends "home/home.html" %}

{% block username %}
    {{ name }}
{% endblock %}

{% block content %}
    <ul class="nav nav-tabs nav-justified" style="white-space: nowrap;">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('home.pop') }}">Pop榜</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('home.jazz') }}">Jazz榜</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('home.rb') }}">R&B榜</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('home.cla') }}">Classical榜</a>
        </li>
    <li class="nav-item">
            <a class="nav-link" href="{{ url_for('home.folk') }}">Folk榜</a>
        </li>

    </ul>

    <table class="table table-hover" id="search-result">
        <thead>
        <tr>
            <th scope="col">序号</th>
            <th scope="col">歌曲</th>
            <th scope="col">歌手</th>
            <th scope="col">专辑</th>
        </tr>
        </thead>
        <tbody>
        {% for song in page_data %}
            <tr id="{{ loop.index }}">
                <th scope="row">{{ loop.index }}</th>
                <td>{{ song.music_name }}</td>
                <td>{{ song.author }}</td>
                <td>{{ song.album }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <script>
        $(document).ready(function () {
            if (typeof ap === 'undefined') {
                const ap = new APlayer({
                    container: document.getElementById('aplayer'),
                    fixed: true,
                    listFolded: true,
                    lrcType: 1
                });

                let data = {{ music_list | safe }};
                let music = data["result"];
                for (let i = 0; i < music.length; i++) {
                    let musicItem = music[i];
                    ap.list.add({
                            name: musicItem["name"],
                            url: "/queryurl/" + musicItem["id"],
                            artist: musicItem["ar"],
                            cover: musicItem["alPic"] + "?param=130y130",
                            lrc: musicItem["lrc"]
                        }
                    );
                }
                $("tr").click(function () {
                    let id = parseInt(this.id);
                    ap.list.switch(id-1);
                    ap.play();
                });
            }
        });
    </script>
{% endblock %}